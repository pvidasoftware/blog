<!DOCTYPE html>
<html lang="es">
<head>
<meta content="text/html; charset=" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="Asciidoctor 1.5.4" name="generator">
<meta content="Jorge Aguilera. PuraVida Software" name="author">
<title>Testea y Documenta tu API REST</title>
<link href="/blog/deck/core/deck.core.css" rel="stylesheet">
<link href="/blog/deck/extensions/scale/deck.scale.css" media="screen" rel="stylesheet">
<link href="/blog/deck/extensions/goto/deck.goto.css" media="screen" rel="stylesheet">
<link href="/blog/deck/extensions/navigation/deck.navigation.css" media="screen" rel="stylesheet">
<link href="/blog/deck/extensions/status/deck.status.css" media="screen" rel="stylesheet">
<link href="/blog/deck/extensions/toc/deck.toc.css" media="screen" rel="stylesheet">
<link href="/blog/deck/themes/style/web-2.0.css" media="screen" rel="stylesheet">
<link href="/blog/deck/themes/transition/horizontal-slide.css" media="screen" rel="stylesheet">
<link href="/blog/deck/core/print.css" media="print" rel="stylesheet">
<link href="/blog/deck/../css/custom-deck.css" media="all" rel="stylesheet">
<script src="/blog/deck/modernizr.custom.js"></script>
</head>
<body class="article">
<div class="deck-container">
<section class="slide" id="title-slide">
<h1>Testea y Documenta tu API REST</h1>
<span id="author">Jorge Aguilera. PuraVida Software</span>
<br>
</section>
<section class="slide" id="rest_tdd_d">
<h2>REST TDD&amp;D</h2>
<div class="paragraph"><p>Test Driven Development and Documenting a Grails Rest app</p></div>
<div class="paragraph slide"><p>o c&oacute;mo usar Spock para completar tu documentaci&oacute;n</p></div>
<div class="paragraph slide"><p>en realidad, c&oacute;mo hacer que documentas como un profesional mientras los test lo hacen por t&iacute;</p></div>
</section>
<section class="slide" id="qu_vamos_a_ver">
<h2>Qu&eacute; vamos a ver</h2>
<div class="openblock slide">
<div class="content">
<div class="ulist">
<ul>
<li>Objetivo</li>
</ul>
</div>
<div class="paragraph"><p>Utilizar los test (unitarios y de integraci&oacute;n) para que hagan el trabajo sucio de documentar nuestras APIs REST.</p></div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Porque si la documentacion no es válida, los servicios REST NO SON VÁLIDOS
(y viceversa,claro)</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li class="slide">Un poco de historia (reciente, tranquilos)</li>
<li class="slide">TwitterPeople. Grails 3.x REST application</li>
<li class="slide">Spockear. Un poco de test nunca viene mal</li>
<li class="slide">Documentando. Que es a lo que hemos venido</li>
</ul>
</div>
</section>
<section class="slide" id="objetivo">
<h2>Objetivo</h2>
<div class="imageblock">
<div class="content">
<img alt="objetivo" src="objetivo.png">
</div>
</div>
</section>
<section class="slide" id="un_poco_de_rest_historia_personal">
<h2>Un poco de REST-historia (personal)</h2>
<div class="openblock slide">
<div class="content">
<div class="paragraph"><p>O de cómo me dejé las pestañas con SOA&#8230;&#8203;</p></div>
<div class="paragraph"><p>que si primero el contrato vs que si primero el java
que si cabecera, que si security, que si payload, &#8230;&#8203;.</p></div>
</div>
</div>
<div class="openblock slide">
<div class="content">
<div class="paragraph"><p>y en tu radar suena REST..
y lo entiendes, y dices esto es para mí&#8230;&#8203; y además Grails tiene un RestController
 .. y hasta un plugin para securizar las llamadas ( @alvaro_sanchez )
 &#8230;&#8203;pero no todo es tan fácil, que si version del API, que si POST o PUT&#8230;&#8203;</p></div>
</div>
</div>
</section>
<section class="slide" id="el_camino_al_nirvana">
<h2>El camino al nirvana</h2>
<div class="ulist">
<ul>
<li class="slide">Llamadas RPC por todos lados.</li>
<li class="slide">Ofreces los datos de tus tablas.</li>
<li class="slide">Permites actualizar, e incluso borrar!!</li>
<li class="slide">Te gustaría incluso enlazar recursos.</li>
</ul>
</div>
</section>
<section class="slide canvas-image" id="glory_of_rest_1" style="background-image: url(./glory_of_rest_1.png)">
<div class="paragraph"><p><a class="bare" href="http://martinfowler.com/articles/richardsonMaturityModel.html">http://martinfowler.com/articles/richardsonMaturityModel.html</a></p></div>
</section>
<section class="slide" id="twitterpeople">
<h2>TwitterPeople</h2>
<div class="paragraph"><p>Proxy de usuarios de Twitter</p></div>
<div class="paragraph"><p><a class="bare" href="https://github.com/jagedn/twitterpeople">https://github.com/jagedn/twitterpeople</a></p></div>
<div class="paragraph"><p>Solicitamos un recurso Person a nuestro servicio y si no lo tiene lo importa desde Twitter</p></div>
<div class="paragraph"><p>(Podíamos hacer la típica aplicación a base de datos, pero &#8230;&#8203;)</p></div>
</section>
<section class="slide" id="twitterpeople_2">
<h2>TwitterPeople</h2>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">java -jar twitterpeople-0.1.jar</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="glaforge" src="glaforge.png">
</div>
</div>
</section>
<section class="slide" id="twitterpeople_3">
<h2>TwitterPeople</h2>
<table class="tableblock frame-all grid-rows" style="width:100%">
<caption class="title">Table 1. Person model</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">followersCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">how many followers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">friendsCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">how many friends</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the user location</p></td>
</tr>
</tbody>
</table>
</section>
<section class="slide" id="domain">
<h2>Domain</h2>
<div class="listingblock">
<div class="title">/src/grails-app/domain/twitterpeople/Person</div>
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">package twitterpeople
import grails.rest.Resource

@Resource(uri='/people',formats=['json','hal'],readOnly=true)
class Person {
    static constraints = {
        description nullable:true
        location nullable:true
    }
    static mapping = {
        id generator: 'assigned', type:'string'
    }
    String id
    String description
    int followersCount
    int friendsCount
    String location
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="interceptor">
<h2>Interceptor</h2>
<div class="listingblock">
<div class="title">/src/grails-app/controller/twitterpeople/PersonInterceptor</div>
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">class PersonInterceptor {
TwitterProxyService twitterProxyService
    boolean before(){
        switch( params.action ){
        case 'show':
            twitterProxyService.createPerson(params.id)
        }
        true
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="service">
<h2>Service</h2>
<div class="listingblock">
<div class="title">/src/grails-app/services/twitterpeople/TwitterProxyService</div>
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">class TwitterProxyService {
    Twitter twitter
    Person createPerson( id ) {
        Person add
        User user
        if( "$id".isNumber() == false ){
            add=Person.get(id)
            if(add){
                return add
            }
            user = twitter.showUser("@${id}")
        }else{
            user = twitter.showUser( id as long)
        }
        if( user ){
            add = new Person(user.properties)
            add.id = id
            if( add.validate() ) {
                add.save(flush: true)
            }
            else{
                println add.errors
            }
        }
        add
    }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="spockeando">
<h2>Spockeando</h2>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/twitterpeople/SimpleSpec</div>
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">void "test user #username"(){
    given:
        RestBuilder rest = new RestBuilder()
    when:
        RestResponse response = rest.get("http://localhost:8080/people/${username}")
    then:
        response.status == 200
        response.json.id == username
    where:
        username | description
        'jagedn' | "nooo, si yo ya...."
        'un_voluntario' | 'seguro que falla el test'
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="documentando">
<h2>Documentando</h2>
<div class="ulist">
<ul>
<li class="slide">Swagger, completísimo &#8230;&#8203; supercomplicado.</li>
<li class="slide">JsonDoc, incorpora hasta un playground &#8230;&#8203; pero no funciona bien en Grails.</li>
</ul>
</div>
<div class="openblock slide">
<div class="content">
<div class="ulist">
<ul>
<li>Spring-rest-doc, esto ya empieza a ser otra cosa</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>Spring REST Docs helps you to document <strong>RESTful services</strong>.
It combines <strong>hand-written</strong> documentation written with <strong>Asciidoctor</strong> and <strong>auto-generated snippets</strong>
 produced with Spring MVC Test.</p></div>
</div>
</div>
<div class="paragraph"><p><a class="bare" href="http://projects.spring.io/spring-restdocs">http://projects.spring.io/spring-restdocs</a></p></div>
</div>
</div>
<div class="openblock slide">
<div class="content">
<div class="ulist">
<ul>
<li>rest-assured, extenso DSL orientado a testear servicios REST</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>Testing and validation of REST services in Java is harder than in dynamic languages such as Ruby and Groovy.
REST Assured brings the simplicity of using these languages into the Java domain.</p></div>
</div>
</div>
<div class="paragraph"><p><a class="bare" href="https://github.com/jayway/rest-assured">https://github.com/jayway/rest-assured</a></p></div>
</div>
</div>
</section>
<section class="slide" id="step_by_step">
<h2>Step by step &#8230;&#8203;</h2>
<div class="ulist">
<ul>
<li class="slide"><a href="../../../blog/2016/twitterpeople_2_2.html#configurando_dependencias" target="_blank">Preparar entorno</a></li>
<li class="slide"><a href="../../../blog/2016/twitterpeople_2_2.html#creando_un_spec" target="_blank">PeopleSpec</a></li>
<li class="slide"><a href="../../../blog/2016/twitterpeople_2_2.html#build" target="_blank">Compilar</a></li>
<li class="slide"><a href="http://localhost:8080/people/jagedn" target="_blank">Vive!!!</a></li>
<li class="slide"><a href="http://localhost:8080/static/docs/index.html" target="_blank">Visualizando la documentación in-situ</a></li>
<li class="slide">&#8230;&#8203;.Nuevas especificaciones, nuevos cambios, nueva documentación, vamos allá</li>
</ul>
</div>
</section>
<section class="slide" id="spring_rest_docs">
<h2>Spring REST docs:</h2>
<div class="ulist">
<ul>
<li>curl-request.adoc</li>
<li>http-request.adoc</li>
<li>http-response.adoc</li>
<li>request-headers.adoc</li>
<li>response-headers.adoc</li>
<li>links.adoc</li>
<li>request-parameters.adoc</li>
<li>path-parameters.adoc</li>
<li>document("apelo")</li>
<li>document("${a_groovy_logic}")</li>
<li>document("{class-name}/{method-name}")</li>
</ul>
</div>
</section>
<section class="slide" id="rest_assured_dsl">
<h2>Rest assured DSL</h2>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">get("/lotto").then().assertThat().body("lotto.lottoId", equalTo(5));

get("/lotto").then().assertThat().body("lotto.winners.winnerId", hasItems(23, 54));

given().
    param("key1", "value1").
    param("key2", "value2").
when().
    post("/somewhere").
then().
    body(containsString("OK"));

String json = get("/lotto").asString()
List&lt;String&gt; winnderIds = from(json).get("lotto.winners.winnerId");</code></pre>
</div>
</div>
</section>
<section class="slide" id="links_e_info">
<h2>Links e Info</h2>
<div class="ulist">
<ul>
<li>@jagedn Jorge Aguilera (me), 20+ años dándole a la tecla</li>
<li>@pvidasoftware Puravida Software, Open source, open mind</li>
<li>Grails (<a class="bare" href="http://www.grails.org">http://www.grails.org</a>)</li>
<li>Spock (<a class="bare" href="http://spockframework.org">http://spockframework.org</a>)</li>
<li>spring-rest-doc (projects.spring.io/spring-restdocs)</li>
<li>rest-assured (<a class="bare" href="https://github.com/jayway/rest-assured">https://github.com/jayway/rest-assured</a>)</li>
<li>AsciiDoc (<a class="bare" href="http://asciidoctor.org">http://asciidoctor.org</a>)</li>
<li>@JennStrater <a class="bare" href="https://github.com/jlstrater/gr8data">https://github.com/jlstrater/gr8data</a></li>
</ul>
</div>
</section>
<section class="slide canvas-image" id="gracias" style="background-image: url(../../gracias_multilingue.jpg)">

</section>
<div aria-role="navigation">
<a class="deck-prev-link" href="#" title="Previous">&#8592;</a>
<a class="deck-next-link" href="#" title="Next">&#8594;</a>
</div>
<p aria-role="status" class="deck-status">
<span class="deck-status-current"></span>
/
<span class="deck-status-total"></span>
</p>
<form action="." class="goto-form" method="get">
<label for="goto-slide">Go to Slide:</label>
<input id="goto-slide" list="goto-datalist" name="slidenum" type="text">
<datalist id="goto-data-list"></datalist>
<input type="submit" value="Go">
</form>
</div>
<script src="/blog/js/jquery-1.11.1.min.js"></script>
<script src="/blog/deck/core/deck.core.js"></script>
<script src="/blog/deck/extensions/scale/deck.scale.js"></script>
<script src="/blog/deck/extensions/goto/deck.goto.js"></script>
<script src="/blog/deck/extensions/navigation/deck.navigation.js"></script>
<script src="/blog/deck/extensions/status/deck.status.js"></script>
<script src="/blog/deck/extensions/toc/deck.toc.js"></script>
<div class="deck-toc"></div>
<script>
  (function($, deck, undefined) {
    $.deck.defaults.keys['previous'] = [8, 33, 37, 39];
    $.deck.defaults.keys['next'] = [13, 32, 34, 39];
  
    $.extend(true, $[deck].defaults, {
        countNested: false
    });
  
    $.deck('.slide');
  })(jQuery, 'deck');
</script>
<style>
  .slide.canvas-image {
  -moz-background-size: contain;
  -webkit-background-size: contain;
  -o-background-size: contain;
  background-size: contain;
  display: -moz-box;
  display: -webkit-box;
  display: -ms-box;
  display: box;
  -moz-box-orient: vertical;
  -webkit-box-orient: vertical;
  -ms-box-orient: vertical;
  box-orient: vertical;
  -moz-box-align: start;
  -webkit-box-align: start;
  -ms-box-align: start;
  box-align: start;
  -moz-box-pack: start;
  -webkit-box-pack: start;
  -ms-box-pack: start;
  box-pack: start;}
  
  .bottom-left {
    left: 1%;
    bottom: 20%; }
  
  .top-left {
    left: 1%;
    top: 20%; }
  
  .bottom-right {
    right: 1%;
    bottom: 20%; }
  
  .top-right {
    right: 1%;
    top: 20%; }
  
  .center-up {
    right: 50%;
    top: 1%;
  }
  
  .center-down {
    right: 50%;
    bottom: 1%;
  }
  .canvas-image .canvas-caption p {
    text-align: center;
    padding-top: 0;
    padding: 0;
    -moz-transform: none;
    -webkit-transform: none;
    -o-transform: none;
    -ms-transform: none;
    transform: none;
    display: inline;
    position: absolute;
    background-color: rgba(0, 0, 0, 0.7);
    font-weight: bold;
    font-size: 58px;
    -webkit-box-shadow: 2px 2px 2px #000;
    -moz-box-shadow: 2px 2px 2px #000;
    box-shadow: 2px 2px 2px #000;
    padding: 1rem;
    color: white; }
  kbd.keyseq { color: #555555; }
  kbd:not(.keyseq) {
    display: inline-block;
    color: #222222;
    font-size: 0.7em;
    line-height: 1.4;
    background-color: #F7F7F7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    margin: -0.15em 0.15em 0 0.15em;
    padding: 0.2em 0.6em;
    vertical-align: middle;
    white-space: nowrap;
  }
  kbd kbd:first-child { margin-left: 0; }
  kbd kbd:last-child { margin-right: 0; }
</style>
</body>
</html>